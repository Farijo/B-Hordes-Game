
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/style/theme.css">
    <link rel="stylesheet" href="/style/table.css">
    <link rel="stylesheet" href="/style/recruit.css">
    <link rel="stylesheet" href="/style/text-input.css">
    <script src="/script/sorttable.js"></script>
</head>
<body>
    {{ template "top-bar.html" . }}
    <h2>{{ .challenge.Name }}</h2>
    <div class="container">
        <a class="box" href="/user/{{ .challenge.Creator.ID }}">
            <div class="line1">Par</div>
            <div class="line2">
                <img class="avatar" src="{{ .challenge.Creator.Avatar.String }}">
                <span class="name">{{ .challenge.Creator.Name }}</span>
            </div>
        </a>
        <div class="box">
            <div class="line1">DÃ©but</div>
            <p></p>
        </div>
        {{ if .challenge.EndDate.Valid }}
            <div class="box">
                <div class="line1">Fin</div>
                <p></p>
                {{ if lt .challenge.Status 4 }}
                    <span class="time-remaining"></span>
                {{ end }}
            </div>
        {{ end }}
    </div>
    <div class="container">
        {{ $userkey := .userkey }}
        {{ $goalHeaders := mkmap }}
        {{ range $goal := .goals }}
            {{ $mm := decodeGoal $userkey $goal $goalHeaders }}
            <div class="box">
                <div class="line1">{{ $mm.Text }}</div>
                <div class="line2"><img src="https://myhordes.eu/build/images/{{ $mm.Icon }}">{{ $mm.Label }} </div>
            </div>
        {{ end }}
    </div>
    <table class="sortable">
        <tr><th>Participants</th>{{ range $_, $goalHeader := $goalHeaders }}<th>{{ $goalHeader.Content }}</th>{{ end }}
        {{ range $partic := .advancement }}
            <tr class="item" onclick="document.location='/user/{{ $partic.ID }}';">
                <td sorttable_customkey="{{ $partic.SimplifiedName }}">
                    <img class="avatar" src="{{ $partic.Avatar.String }}">
                    <span class="name">{{ $partic.Name }}</span>
                </td>
                {{ range $k, $g := $goalHeaders }}
                    {{ $s := index $partic.Successes $k }}
                    <td {{ if gt $s.Amount 0 }}title="{{ $s.Accomplished }}" sorttable_customkey="{{ $s.Amount }}"{{end}}>
                        {{ if ne $g.Amount 0 }}
                            <img src="data:image/gif;base64,R0lGODlhEAAQAKIGA{{ if ge $s.Amount $g.Amount }}K2mTmU+Itv/cpZ6PP///4esPn5NKgAAACH5BAEAAAYALAAAAAAQABAAAAM0aLrc/jDKuQa4d0AbegeaAwSFYBYB8IwCQZjpGrSmEIvz+97NWJ48BseTCjksGBBlyVwmAAA7{{ else }}GU+Ip0mBLVcQoAyE86Sgf///35NKgAAACH5BAEAAAYALAAAAAAQABAAAAMmaLrc/jDKSSG4V4IhQhhABAgF0YVWQHgB+gBBd4oDC2qYW+18DyUAOw=={{ end }}" />
                        {{ end }}
                        {{ if ne $g.Amount 1 }}
                            {{ $s.Amount }}
                        {{ end }}
                    </td>
                {{ end }}
            </tr>
        {{ end }}
    </table>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha384-NXgwF8Kv9SSAr+jemKKcbvQsz+teULH/a5UNJvZc6kP47hZgl62M1vGnw6gHQhb1" crossorigin="anonymous"></script>
    <script>
        $('p').first().text(new Date("{{ .challenge.StartDate.String }}Z").toLocaleString());
        $('td[title]').each((i, e) => {
            const d = e.title;
            if(d) {
                const dd = new Date(d+'Z');
                e.setAttribute("sorttable_customkey", e.getAttribute("sorttable_customkey") + (Date.now() - dd.getTime()));
                e.title = dd.toLocaleString();
            }
        });
    </script>
</body>
</html>
