<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/style/theme.css">
    <link rel="stylesheet" href="/style/creation.css">
    <script>
        {{ .srvData }}
    </script>
    <title>Î²'Hordes Games</title>
</head>
<body>
    {{ template "top-bar.html" . }}
    <form method="POST" style="width:fit-content">
        <table>
            <tr>
                <td><label>{{ translate .ctx "name" }}</label></td>
                <td><input type="text" name="name" maxlength="64" autocomplete="off" {{ if .challenge }} value="{{ .challenge.Name }}" {{ end }} required/></td>
            </tr>
            <tr>
                <td><label>{{ translate .ctx "participation" }}</label></td>
                <td>
                    <select name="participation">
                        <option value="0">{{ translate .ctx "open-to-all" }}</option>
                        <option value="1">{{ translate .ctx "on-request" }}</option>
                        <option value="2">{{ translate .ctx "on-invite" }}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label>{{ translate .ctx "visibility" }}</label></td>
                <td>
                    <select name="privat">
                        <option value="0">{{ translate .ctx "public" }}</option>
                        <option value="1" title="{{ translate .ctx "private-desc" }}">{{ translate .ctx "private" }}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label>{{ translate .ctx "goals" }}</label></td>
                <td>
                    <div id="all-goals">
                    </div>
                    <img id="more"/>
                </td>
            </tr>
            <tr>
                <td><label>{{ translate .ctx "validation-modes" }}</label></td>
                <td>
                    <label for="validation_api" class="checklabel"><input type="checkbox" name="validation_api" value="1" id="validation_api" checked/>{{ translate .ctx "api" }}</label>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <button type="submit" name="act" value="save">{{ translate .ctx "save" }}</button>
                    <button type="submit" name="act" value="validate">{{ translate .ctx "validate" }}</button>
                    <button type="submit" name="act" value="modify">{{ translate .ctx "modify" }}</button>
                    <button type="submit" name="act" value="open-inscriptions">{{ translate .ctx "open-inscriptions" }}</button>
                </td>
            </tr>
        </table>
    </form>
    <script src='https://cdn.jsdelivr.net/npm/@widgetbot/crate@3' async defer>
        crate = new Crate({
            server: '1253836492694880367', // B'Hordes Games
            channel: '{{ translate .ctx "discord-create-challenge" }}',
            color: '#371a13',
            glyph: ["/question-mark.svg", "100%"]
        })
    </script>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha384-NXgwF8Kv9SSAr+jemKKcbvQsz+teULH/a5UNJvZc6kP47hZgl62M1vGnw6gHQhb1" crossorigin="anonymous"></script>
<script>
    const goalhtml=`{{ template "goal.html" .ctx }}`;
    const mh_lng=`{{ translate .ctx "mh-lang" }}`;
</script>
<script src="/script/make_challenge.js"></script>
<script>
    {{ if .challenge }}
        const goals = [{{ range .goals }}{{ dumpStruct . }},{{ end }}];
        bindFormValues({{ .challenge.Access }}, {{ .challenge.Private }}, goals, {{ .challenge.API }})
        {{ if eq .challenge.Status 0 }}
            $('[value=modify]').css('display', 'none');
            $('[value=open-inscriptions]').css('display', 'none');
        {{ end }}
        {{ if eq .challenge.Status 1 }}
            $('form table *:not([type=submit])').prop('disabled', true);
            $('#more').css('cursor', 'not-allowed').prop('onclick', null).off('click');
            $('[value=save]').css('display', 'none');
            $('[value=validate]').css('display', 'none');
        {{ end }}
    {{ else }}
        addAGoal(false);
        $('[value=modify]').css('display', 'none');
        $('[value=open-inscriptions]').css('display', 'none');
    {{ end }}
</script>
</html>
